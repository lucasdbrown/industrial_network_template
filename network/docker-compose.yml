services:
  god_debug:
    image: alpine:latest
    networks:
      enterprise_network:
        ipv4_address: 192.168.10.69
      idmz_network:
        ipv4_address: 192.168.20.69
      industrial_network:
        ipv4_address: 192.168.30.69
      assembly_network:
        ipv4_address: 192.168.31.69
      utilities_network:
        ipv4_address: 192.168.32.69
      packaging_network:
        ipv4_address: 192.168.33.69
      site_operations_network:
        ipv4_address: 192.168.39.69
    entrypoint: [ "/bin/sh", "-c", "sleep infinity" ]

  # Enterprise Router (Routes Enterprise <-> IDMZ)
  enterprise_router:
    build:
      context: ./routers
      dockerfile: DockerFile
    container_name: enterprise_router
    hostname: enterprise_router
    volumes:
      - ./routers/enterprise_router.conf:/etc/frr/frr.conf:ro
      - ./routers/daemons:/etc/frr/daemons:ro
      - ./routers/start_frr.sh:/mnt/start_frr.sh:ro
      - ./routers/setup_routes.sh:/mnt/setup_routes.sh:ro
    networks:
      enterprise_network:
        ipv4_address: 192.168.10.10
      idmz_network:
        ipv4_address: 192.168.20.10
    entrypoint: [ "/bin/sh", "-c", "/start_frr.sh" ]

  # IDMZ Router (Routes IDMZ <-> Industrial)
  idmz_router:
    build:
      context: ./routers
      dockerfile: DockerFile
    container_name: idmz_router
    volumes:
      - ./routers/idmz_router.conf:/etc/frr/frr.conf:ro
      - ./routers/daemons:/etc/frr/daemons:ro
      - ./routers/start_frr.sh:/mnt/start_frr.sh:ro
      - ./routers/setup_routes.sh:/mnt/setup_routes.sh:ro
    networks:
      idmz_network:
        ipv4_address: 192.168.20.11 # Gateway for IDMZ
      industrial_network:
        ipv4_address: 192.168.30.10 # Gateway for Industrial Zone
    entrypoint: [ "/bin/sh", "-c", "/start_frr.sh" ]

  # Industrial Core Switch (Main switch in Industrial Zone)
  industrial_core_switch:
    build:
      context: ./routers
      dockerfile: DockerFile
    container_name: industrial_core_switch
    hostname: industrial_core_switch
    volumes:
      - ./routers/industrial_core_switch.conf:/etc/frr/frr.conf:ro
      - ./routers/daemons:/etc/frr/daemons:ro
      - ./routers/start_frr.sh:/mnt/start_frr.sh:ro
      - ./routers/setup_routes.sh:/mnt/setup_routes.sh:ro
    networks:
      industrial_network:
        ipv4_address: 192.168.30.253
      assembly_network:
        ipv4_address: 192.168.31.254
      utilities_network:
        ipv4_address: 192.168.32.254
      packaging_network:
        ipv4_address: 192.168.33.254
    entrypoint: [ "/bin/sh", "-c", "/start_frr.sh" ]

  # Assembly Switch (Enclave 1)
  assembly_switch:
    build:
      context: ./routers
      dockerfile: DockerFile
    container_name: assembly_switch
    hostname: assembly_switch
    volumes:
      - ./routers/assembly_switch.conf:/etc/frr/frr.conf:ro
      - ./routers/daemons:/etc/frr/daemons:ro
      - ./routers/start_frr.sh:/mnt/start_frr.sh:ro
      - ./routers/setup_routes.sh:/mnt/setup_routes.sh:ro
    networks:
      assembly_network:
        ipv4_address: 192.168.31.253
      industrial_network:
        ipv4_address: 192.168.30.251
    entrypoint: [ "/bin/sh", "-c", "/start_frr.sh" ]

  # Utilities Switch (Enclave 2)
  utilities_switch:
    build:
      context: ./routers
      dockerfile: DockerFile
    container_name: utilities_switch
    hostname: utilities_switch
    volumes:
      - ./routers/utilities_switch.conf:/etc/frr/frr.conf:ro
      - ./routers/daemons:/etc/frr/daemons:ro
      - ./routers/start_frr.sh:/mnt/start_frr.sh:ro
      - ./routers/setup_routes.sh:/mnt/setup_routes.sh:ro
    networks:
      utilities_network:
        ipv4_address: 192.168.32.253
      industrial_network:
        ipv4_address: 192.168.30.240
    entrypoint: [ "/bin/sh", "-c", "/start_frr.sh" ]

  # Packaging Switch (Enclave 3)
  packaging_switch:
    build:
      context: ./routers
      dockerfile: DockerFile
    container_name: packaging_switch
    hostname: packaging_switch
    volumes:
      - ./routers/packaging_switch.conf:/etc/frr/frr.conf:ro
      - ./routers/daemons:/etc/frr/daemons:ro
      - ./routers/start_frr.sh:/mnt/start_frr.sh:ro
      - ./routers/setup_routes.sh:/mnt/setup_routes.sh:ro
    networks:
      packaging_network:
        ipv4_address: 192.168.33.253
      industrial_network:
        ipv4_address: 192.168.30.249
    entrypoint: [ "/bin/sh", "-c", "/start_frr.sh" ]

networks:
  enterprise_network:
    name: enterprise_network
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.10.0/24
          #gateway: 192.168.10.1
    driver_opts:
      com.docker.network.bridge.name: br_enterprise

  idmz_network:
    name: idmz_network
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.20.0/24
          #gateway: 192.168.20.1
    driver_opts:
      com.docker.network.bridge.name: br_idmz

  industrial_network:
    name: industrial_network
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.30.0/24
          #gateway: 192.168.30.1
    driver_opts:
      com.docker.network.bridge.name: br_industrial

  assembly_network:
    name: assembly_network
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.31.0/24
        # gateway: 192.168.31.254

  utilities_network:
    name: utilities_network
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.32.0/24
        #  gateway: 192.168.32.254

  packaging_network:
    name: packaging_network
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.33.0/24
        #  gateway: 192.168.33.254

  site_operations_network:
    name: site_operations_network
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.39.0/24
        #  gateway: 192.168.39.254 
